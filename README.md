# hse24_hw1

```bash
/bin/bash

SEED=214
THREADS=1

report() {
cd
mkdir $1_report
cd $1_report
mkdir fastqc
fastqc ~/$1/* -o fastqc -t $THREADS
mkdir multiqc
multiqc fastqc --filename "multiqc_report_$1" --outdir "multiqc"
}

cd
if [ ! -d "src" ]; then
mkdir src
cd src
ln -s /usr/share/data-minor-bioinf/assembly/oil_R1.fastq pe1.fq
ln -s /usr/share/data-minor-bioinf/assembly/oil_R2.fastq pe2.fq
ln -s /usr/share/data-minor-bioinf/assembly/oilMP_S4_L001_R1_001.fastq mp1.fq
ln -s /usr/share/data-minor-bioinf/assembly/oilMP_S4_L001_R2_001.fastq mp2.fq
fi
cd
if [ ! -d "sub" ]; then
mkdir sub
seqtk sample -s "$SEED" src/pe1.fq 5000000 > sub/pe1_sub.fq
seqtk sample -s "$SEED" src/pe2.fq 5000000 > sub/pe2_sub.fq
seqtk sample -s "$SEED" src/mp1.fq 1500000 > sub/mp1_sub.fq
seqtk sample -s "$SEED" src/mp2.fq 1500000 > sub/mp2_sub.fq
fi
cd
if [ ! -d "sub_report" ]; then
report sub
fi
cd
if [ ! -d "trimmed" ]; then
mkdir trimmed
echo -e "sub/pe1_sub.fq\nsub/pe2_sub.fq" > trimmed/pe.fofn
echo -e "sub/mp1_sub.fq\nsub/mp2_sub.fq" > trimmed/mp.fofn
platanus_trim -i trimmed/pe.fofn -t $THREADS
platanus_internal_trim -i trimmed/mp.fofn -t $THREADS
mv sub/*trimmed trimmed/
fi
cd
if [ ! -d "trimmed_report" ]; then
report trimmed
fi
cd
if [ ! -d "assemble" ]; then
mkdir assemble
platanus assemble -o platanus -f trimmed/*trimmed -t $THREADS
mv platanus* assemble
fi
cd
if [ ! -d "scaffold" ]; then
mkdir scaffold
platanus scaffold \
         -o platanus \
         -c assemble/platanus_contig.fa \
  -b assemble/platanus_contigBubble.fa \
  -IP1 trimmed/*.trimmed \
  -OP2 trimmed/*.int_trimmed \
  -t $THREADS
mv platanus* scaffold
fi
cd
if [ ! -d "gap_close" ]; then
mkdir gap_close
platanus gap_close \
  -o platanus \
  -c scaffold/platanus_scaffold.fa \
  -IP1 trimmed/*.trimmed \
  -OP2 trimmed/*.int_trimmed \
  -t $THREADS
mv platanus* gap_close
fi
cd
if [ ! -d "data" ]; then
mkdir data
cp assemble/platanus_contig.fa data/contigs.fasta
cp gap_close/platanus_gapClosed.fa data/scaffolds.fasta
fi
```
### Оценим качество исходных чтений и получим по ним общую статистику с помощью программы [fastQC](https://www.bioinformatics.babraham.ac.uk/projects/fastqc/) и [multiQC](https://multiqc.info/)

<img width="874" alt="%D0%A1%D0%BD%D0%B8%D0%BC%D0%BE%D0%BA%20%D1%8D%D0%BA%D1%80%D0%B0%D0%BD%D0%B0%202024-10-05%20%D0%B2%2016 38 43" src="https://github.com/user-attachments/assets/7446cb80-718f-400d-8c9a-cbb5183d6158">

**mp1_sub:**

- **% Дупликаций:** 4.4% — невысокий процент дупликаций, что говорит о хорошем качестве данных.
- **% GC:** 44% — типичный уровень для большинства организмов.
- **Длина прочтений:** 251 bp — длинные прочтения, что хорошо для сборки.

**mp2_sub:**

- **% Дупликаций:** 3.9% — также низкий процент, что говорит о низком уровне дублирования и высоком качестве данных.
- **% GC:** 44% — соответствует первому файлу mate-pair.

**pe1_sub:**

- **% Дупликаций:** 32.1% — более высокий процент дупликаций по сравнению с mate-pair, что может указывать на избыточность данных или артефакты.
- **% GC:** 46% — немного выше, чем у mate-pair данных, что может быть особенностью фрагмента.
- **Длина прочтений:** 101 bp — короткие прочтения, стандартные для paired-end данных.

**pe2_sub:**

- **% Дупликаций:** 30.6% — также высокий процент дупликаций, схожий с pe1_sub.
- **% GC:** 46% — аналогично pe1_sub.


![fastqc_per_base_sequence_quality_plot — копия 2](https://github.com/user-attachments/assets/2d5c3d7c-e929-4064-9291-653c4ec6046f)


**pe1_sub и pe2_sub (passed) -** прошли проверку качества, имеют высокое качество, без значительных ошибок или деградации по позициям

![Unknown-2](https://github.com/user-attachments/assets/436d10b0-a1a3-4bc6-a845-709829788397)

![Unknown-3](https://github.com/user-attachments/assets/5b0bbdda-79c2-4253-ac71-604caf28aa16)


**mp1_sub (with warnings) -** качество чтений имеет некоторые отклонения. Возможно, в некоторых позициях последовательности наблюдается ухудшение качества чтений.
![Unknown-1](https://github.com/user-attachments/assets/53397063-7bb9-4cd3-8cdb-37929510c430)


**mp2_sub (failed) - н**а гистограмме есть вызовы приемлемого качества (оранжевый) и вызовы низкого качества (красный), указывает на то, что значительная часть ридов имеет средние качественные оценки, которые существенно ниже ожидаемого уровня. Такие данные могут содержать большое количество ошибок и «шумов» так как имеют низкокачественные позиции во многих местах, поэтому необходимо провести trimming. 

![Unknown](https://github.com/user-attachments/assets/2d0cf24e-2e34-4e11-9998-9143c9fadd7d)



![fastqc_per_sequence_quality_scores_plot](https://github.com/user-attachments/assets/41bf37f7-296e-4740-baf0-2385d73463cf)

График **Per Sequence Quality Scores** показывает распределение среднего качества прочтений по всему набору данных. Помогает выявить наличие чтений с низким качеством (в данном случае все риды имеют хорошее качество тк по оси X достигают больших значений), а также распределение качества по всему набору. Если большинство данных имеет высокое качество, то пик на графике будет на стороне высоких значений (ближе к 40), что и произошло в нашем случае.

![fastqc_adapter_content_plot](https://github.com/user-attachments/assets/0952b3c0-2953-486a-ac15-4700bb189368)

Метрика **Adapter Content** показывает наличие адаптерных последовательностей в данных секвенирования. По графику видно, что **mp1_sub** и **mp2_sub** содержат адаптерные последовательности, которые могут исказить результаты анализа, так как не являются частью исходного генома. Возможно по этой причине данные файлы не прошли проверку по качеству ридов. Таким образом, для этих последовательностей нужно провести тримминг - удаление адаптеров с концов прочтений. 

В остальном все файлы показали отличный результат из других графиков: присутствует равномерное распределение нуклеотидов во всех случаях, распределение ридов по GC составу в пределах нормы, все риды имеют высокое качество, библиотека была нарезана и секвенирована более менее равномерно, поэтому каждый рид встречается небольшое число раз. 

## Оценим качество подрезанных чтений и получим по ним общую статистику с помощью программы [fastQC](https://www.bioinformatics.babraham.ac.uk/projects/fastqc/) и [multiQC](https://multiqc.info/)

<img width="834" alt="%D0%A1%D0%BD%D0%B8%D0%BC%D0%BE%D0%BA%20%D1%8D%D0%BA%D1%80%D0%B0%D0%BD%D0%B0%202024-10-06%20%D0%B2%2013 09 56" src="https://github.com/user-attachments/assets/6aa504d0-474d-480c-b503-776ea8a64b45">


**Процент дупликатов** уменьшился для **mp1_sub** и **mp2_sub** по сравнению с их значениями до тримминга (были 4.4% и 3.9%, соответственно). Это хороший показатель, так как дупликаты могут усложнять сборку и анализ.В то же время, **pe1_sub** и **pe2_sub** остаются с высоким процентом дупликатов (30.3% и 29.3%), что близко к исходным значениям (32.1% и 30.6%). Это может указывать на то, что после тримминга удалились только адаптеры и низкокачественные части, а значительное количество дублирующихся чтений осталось, которые могут быть биологическими или возникать из-за процесса секвенирования.

**GC-содержание** для всех образцов осталось почти неизменным (около 46%), что свидетельствует о стабильности данных и отсутствии существенных изменений в содержимом ридов после тримминга. Это ожидаемый результат, так как содержание GC определяется исходной ДНК и не должно сильно изменяться в процессе обработки данных.

**Длина прочтений** после тримминга сократилась. Это было ожидаемо, так как тримминг удаляет адаптеры и низкокачественные участки в конце прочтений. Для mate-pair данных (**mp1_sub** и **mp2_sub**) длина сократилась до 111 bp и 105 bp, что свидетельствует о существенном тримминге по сравнению с исходной длиной 251 bp, возможно из-за удаления адаптерных последовательностей. Для paired-end данных (**pe1_sub** и **pe2_sub**) длина сократилась не так сильно, но все равно достигла 97 bp и 96 bp по сравнению с исходными 101 bp.

**Количество прочтений** после тримминга немного уменьшилось для всех образцов. Это также ожидаемо, так как в процессе тримминга удаляются не только низкокачественные участки, но и некоторые прочтения, которые не соответствуют минимальным критериям качества. 

![fastqc_per_base_sequence_quality_plot%C2%A0%E2%80%94%20%D0%BA%D0%BE%D0%BF%D0%B8%D1%8F](https://github.com/user-attachments/assets/fd897e07-cbed-46a9-8fd7-41bd58e694ae)

Cреднее качество всех нуклеотидов в каждом риде по позициям является хорошим для всех файлов. Данные **mp1_sub** и **mp2_sub** стали более ровными и высокими, что говорит о том, что тримминг прошел успешно. Данные **pe1_sub и pe2_sub** не изменились по сравнению с тем, что было до тримминга.
![fastqc_adapter_content_plot%C2%A0%E2%80%94%20%D0%BA%D0%BE%D0%BF%D0%B8%D1%8F](https://github.com/user-attachments/assets/9b5546f9-3b47-48d7-be4d-46cea83de84f)

По всем остальным параметрам в Multiqc триммированные данные прошли проверки на качества, включая метрику **Adapter Content**, которая позволяет убедиться, что мы успешно смогли избавиться от адаптерных последовательностей для **mp1_sub** и **mp2_sub**

Программа FastQC также показывает улучшение качества ридов для **mp1_sub** и **mp2_sub** соответственно. Данные по **pe1_sub** и **pe2_sub** остались без существенных изменений**.**

**mp1_sub**
![Unknown-4](https://github.com/user-attachments/assets/3e1893f2-1353-440f-b274-65acbdca0b27)

**mp2_sub** 
![Unknown-5](https://github.com/user-attachments/assets/653cc2cb-82ac-467a-83d9-cf6d6cd09b8e)


По всем остальным метрикам все также хорошо, кроме Per tile sequence quality для **mp1_sub**, которая анализирует качество секвенирования по каждой "плитке" (tile) на секвенаторе и проверяет, нет ли отклонений в качестве прочтений, происходящих на конкретных плитках. В данном случае на графике можно увидеть несколько красных плиток. Это означает, что в данных местах могут присутствовать проблемы, вызванные дефектами на поверхности платформы или в работе устройства. Также может быть наличие физических препятствий (пыль, грязь, пузырьки воздуха), которые блокируют успешное секвенирование на этих участках или если на плитке меньшее количество кластеров или кластеры распределены неравномерно.




### Анализ полученных контигов

**Общее количество контигов: 502 -**  после сборки генома было собрано 502 отдельных фрагмента ДНК. Контиги представляют собой последовательности, которые собраны без разрывов. Большое их количество может указывать на то, что сборка неполная или что существует множество разрывов в последовательности генома, которые не удалось соединить, так как чем меньше количество контигов, тем лучше сборка.

**Общая длина контигов: 3,921,867 bp -** общая длина всех контигов составляет примерно 3,92 млн оснований (bp), в идеале он должен приближаться к ожидаемому размеру генома, однако в данном случае мы не знаем конкретно название бактерии, поэтому тяжело сказать, насколько данное значение является правильным. Однако в интернете я нашла несколько видов типичных нефтеразлагающих бактерий: **Pseudomonas aeruginosa**, имеет геном размером около 6.3 миллионов bp. **Alcanivorax borkumensis**, имеет геном размером примерно 3.1 миллиона bp. Наше значение попадает в этот диапазон, поэтому можно говорить о том, что сборка прошла вполне успешно. 

**Длина самого длинного контига: 240,663 bp -** хотя сборка не идеальна, были получены относительно длинные непрерывные фрагменты. Чем длиннее контиги, тем более успешной считается сборка, так как это означает, что секвенатор смог собрать большие участки без разрывов.

**N50: 115,749 bp -** показывает, что 50% генома содержится в контигах длиной не менее 115,749 оснований. Эта метрика учитывает не только количество контигов, но и их длину. Чем выше N50, тем качественнее сборка, так как это означает, что значительная часть генома представлена длинными контигами. В данном случае N50 достаточно велико (115,749 bp), то есть сборка содержит длинные контиги, несмотря на большое количество фрагментов.

### Анализ полученных скаффолдов

**Общее количество скаффолдов -** снижение с 502 контигов до 83 скаффолдов показывает успешное объединение многих контигов в более длинные непрерывные последовательности. 

**Общая длина скаффолдов** - длина скаффолдов немного меньше, чем общая длина контигов (3,876,570 bp против 3,921,867 bp). 

**Длина самого длинного скаффолда** - длина самого длинного скаффолда (3,834,495 bp) очень близка к общей длине генома. Это указывает на то, что почти весь геном был собран в одном крупном скаффолде, что является хорошим признаком качественной сборки.

**N50** для скаффолдов (3,834,495 bp) указывает, что половина всей длины сборки приходится на скаффолд длиной не менее 3,834,495 bp. Это очень высокое значение, и оно совпадает с длиной самого длинного скаффолда, что говорит о том, что основная часть генома была собрана в одном или нескольких крупных скаффолдах.

### Количество гэпов и общая длина самого длинного скаффолда до и после подрезания чтения с помощью программы gap_close

**Количество гэпов** уменьшилось с **46 до 12 -** программа gap_close успешно закрыла большинство гэпов. Это показывает, что дополнительные чтения помогли восстановить непрерывность последовательностей.

**Общая длина гэпов** уменьшилась с **6,642 bp до 3,373 bp -** не только количество гэпов снизилось, но и размер оставшихся гэпов значительно сократился.

**Общая длина самого длинного скаффолда -** практически та же
